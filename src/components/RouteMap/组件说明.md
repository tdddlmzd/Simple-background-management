# RouteMap.vue
## 轨迹展示组件

### 使用说明
> 1. 引入【package.json】中**dependencies**所依赖库。
> 2. 将RouteMap文件夹拷贝到项目的自定义组件文件夹中。
> 3. 在需要展示轨迹的组件中引入**RouteMap**组件，然后将参数按要求传递给组件。

### 组件参数

参数 | 说明 | 类型 | 可选值 | 默认值
---|---|---|---|---
route-info | 航线信息，具体格式参考mock文件夹中【参数模板.json】文件 | Object | - | -
width | 宽度 | String | - | 100%
height | 高度 | String | - | 800px
zoom | 地图缩放等级 | Number | 1-18 | -

> #### 注意
> 1. 各平台请求参数配置在【api.js】```platform```常量中。  
> 2. 模拟数据仅在当前项目中生效，禁用模拟数据展示时修改 【api.js】 中 ```mock``` 常量的值为 ```false```，默认为```true```。  
> 3. 模拟数据在【RouteMap → mock】文件夹中，如需替换数据，修改【api.js】中第76行中引用的数据源即可。  

### 组件业务逻辑说明

> 1. 调用```getShipInfo``` 根据传入航线信息（routerInfo)组合出码头信息```wharfs```，从船达通获取船舶详细信息```shipsInfo.[shipId].detail```
> 2. 从船达通获取所有船舶最近几月的靠港记录```shipsInfo.[shipId].portRecord```
> 3. 组合每艘船历史靠港记录```shipsInfo.[shipId].historyPorts```  
> 遍历航线信息中每艘船舶的港口信息，如果有上次进港时间与离港时间（起始港只需离港时间，目的港只需到港时间），则不做处理，直接放入历史靠港记录，如果没有，则从【2】中获取的靠港记录中查找获取。  
> _**如果此项记录缺失，航线将会用港口坐标直接连线。**_
> 4. 根据【3】中历史靠港记录时间，从船达通查询船舶每两个港口间的轨迹，**_如果没有靠港时间，则直接使用港口坐标_**。  
> 至此整个航线的历史轨迹点获取完毕。
> 5. 判断航线信息中第一艘船舶是否已出发```alreadyStart```  
> 如果已发船，则根据航线信息的离港时间和到达时间查询船舶实时轨迹```realTimePath```。  
> 如果未发船，则获取船舶从最近靠港港口到达出发港口的历史轨迹```toPolPath```以及船舶从上个靠港港口出发后的实时轨迹```realTimePath```。
